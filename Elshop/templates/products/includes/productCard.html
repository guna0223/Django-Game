<!-- products/includes/productCard.html -->
<div class="card product-card h-100 fade-in-up scroll-card" data-stock="{% if product.stock > 0 %}in{% else %}out{% endif %}"
    data-product-id="{{ product.id }}">

    <div class="card-img-top-wrapper tilt-container">
        <a href="{% url 'product_details' product.pk %}" class="text-decoration-none text-dark">

            {% if product.thumbnail %}
            <img src="{{ product.thumbnail.url }}" class="card-img-top product-thumb" alt="{{ product.title }}">
            {% else %}
            <div class="product-thumb placeholder-img">
                No Image
            </div>
            {% endif %}

        </a>

    </div>

    <div class="card-body d-flex flex-column">

        <a href="{% url 'product_details' product.pk %}" class="text-decoration-none text-dark">

            <h5 class="card-title product-title">
                {{ product.title|truncatechars:23 }}
            </h5>

            <p class="card-text product-desc">
                {{ product.desc|truncatechars:70 }}
            </p>

            <div class="mt-auto">
                <span class="product-price product-price-line-through">
                    ₹ {{ product.price }}
                </span>

                {% if product.discount %}
                <span class="offer">
                    off <span class="product-discount">{{ product.discount }}%</span>
                    <span class="new-price">
                        ₹ {{ product.offer_price|floatformat:2 }}
                    </span>
                </span>
                {% endif %}
            </div>

        </a>

        {% if user.is_staff %}
        <a href="{% url 'edit_product' product.pk %}" class="btn btn-primary mt-3 add-to-cart">
            <i class="bi bi-plus-circle"></i> Edit Product 
        </a>

        {% else %}

        {% if product.stock > 0 %}
        
        {% if user.is_authenticated %}
        <button class="btn btn-sm btn-primary w-100 add-to-cart">
            Add to Cart
        </button>
        {% else %}
        <a class="btn btn-sm btn-primary w-100 add-to-cart" href="{% url 'signin' %}">
            <i class="bi bi-box-arrow-in-right me-2"></i> Login
        </a>
        {% endif %}

        {% if product.stock <= 5 %} <small class="text-warning d-block mt-2">
            ⚠ Only {{ product.stock }} left in stock
            </small>
            {% endif %}

            {% else %}

            <button class="btn btn-sm btn-secondary w-100 out-of-stock" disabled>
                Out of Stock
            </button>

            {% endif %}

            {% endif %}



    </div>
</div>